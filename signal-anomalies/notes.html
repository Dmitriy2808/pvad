<h1 id="проблемы-в-простых-данных">Проблемы в &quot;простых&quot; данных</h1>
<h2 id="введение">Введение</h2>
<p>Исходный код примеров - <strong>example.py</strong>. Синтезированные сигналы, иллюстрирующие некоторые проблемы, встречающиеся в измерительных сигналах.</p>
<p>При работе с данными &quot;вслепую&quot; получаем большие проблемы даже при маленьких аномалиях.</p>
<p>Данные могут сопровождаться положительным признаком достоверности. Аномалии - результат ошибок программирования, неправильного подключения, настройки, поломок, износа и т.п.</p>
<p>Вспомогательный код:</p>
<pre><code>import matplotlib.pyplot as plt
import numpy as np
import scipy.signal as sig


DT, FS = 0.02, 50
FILTER_LEN = 301


def synth():
    &quot;&quot;&quot;Return test signal.&quot;&quot;&quot;
    freqs = [0.25, 3]
    amps = [1, 0.05]
    ts = np.arange(0, 60, DT)
    xs = amps[0] * np.cos(2*np.pi*freqs[0]*ts) + 50
    xs += amps[1] * np.cos(2*np.pi*freqs[1]*ts) + 50
    return xs, ts


def filt(xs, fband, ntaps=301):
    &quot;&quot;&quot;Filters signal.&quot;&quot;&quot;
    h = sig.firwin(cutoff=fband, pass_zero=False, fs=FS, numtaps=ntaps)
    return sig.lfilter(h, [1], xs)


def run(func):
    &quot;&quot;&quot;Runs example with single figure output.&quot;&quot;&quot;
    fig = plt.figure()
    func()
    plt.tight_layout()
    plt.savefig(&quot;{}.png&quot;.format(func.__name__))
    plt.close(fig)</code></pre>
<p>Разберем его. Здесь</p>
<pre><code>import matplotlib.pyplot as plt
import numpy as np
import scipy.signal as sig</code></pre>
<p>импортируются библиотеки для рисования графиков, работы с массивами и цифровой обработки сигналов.</p>
<p>Константы:</p>
<ul>
<li><code>DT</code> - шаг дискретизации (через какое время брать очередное значение сигнала), измеряется в секундах.</li>
<li><code>FS</code> - частота дискретизации (сколько раз в секунду берется значение сигнала), изменяется в Герцах.</li>
<li><code>FILTER_LEN</code> - длина фильтра, которая используется во всех приведенных примерах, где требуется фильтрация.</li>
</ul>
<p><strong>TODO</strong> что за фильтрация, какова ее роль в наших задачах? Почему рассматривается именно фильтрация?</p>
<p>Функция <code>synth</code> возвращает сигнал, представляющий собой сумму двух гармонических составляющих с частотами 0.25 Гц и 3 Гц. Амплитуды (размах) гармоник соответственно равны 1 и 0.05. Т.е. у высокочастотной составляющей амплитуда намного меньше.</p>
<h2 id="достоверный-ноль">Достоверный ноль</h2>
<p>Мы иногда встречаемся с такой ситуацией. Пример про &quot;резонанс&quot;.</p>
<p>Скачок и фильтрация.</p>
<pre><code>xs, ts = synth()
xf = filt(xs, [2, 4], FILTER_LEN)
xs[len(xs) // 2] = 0
xfz = filt(xs, [2, 4], FILTER_LEN)

plt.subplot(311)
plt.plot(ts[FILTER_LEN:], xs[FILTER_LEN:])
plt.grid(True)

plt.subplot(312)
plt.plot(ts[FILTER_LEN:], xf[FILTER_LEN:])
plt.grid(True)

plt.subplot(313)
plt.plot(ts[FILTER_LEN:], xfz[FILTER_LEN:])
plt.grid(True)</code></pre>
<div class="figure">
<img src="./ex_zero.png" alt="Фильтрация сигнала с достоверным нулем" />
<p class="caption">Фильтрация сигнала с достоверным нулем</p>
</div>
<h2 id="повторяющиеся-скачки">Повторяющиеся скачки</h2>
<pre><code>for i in range(5):
    xs[len(xs)//2 + i*50] = 0
xf = filt(xs, [2, 4], FILTER_LEN)</code></pre>
<div class="figure">
<img src="./ex_jumps.png" alt="Повторяющиеся скачки" />
<p class="caption">Повторяющиеся скачки</p>
</div>
<h2 id="пропадание-сигнала">Пропадание сигнала</h2>
<pre><code>xs, ts = synth()
xs[len(xs)//2-300:len(xs)//2] = 0
xf = filt(xs, [2, 4], FILTER_LEN)</code></pre>
<div class="figure">
<img src="./ex_long_zero.png" alt="Пропадание сигнала на некоторое время" />
<p class="caption">Пропадание сигнала на некоторое время</p>
</div>
<h2 id="пропуск">Пропуск</h2>
<pre><code>xs, ts = synth()
n = len(xs)//2
xs[n] = None
xf = filt(xs, [2, 4], FILTER_LEN)</code></pre>
<p>Только одно значение пропущено!</p>
<div class="figure">
<img src="./ex_skip.png" alt="Фильтрация сигнала с одним пропуском" />
<p class="caption">Фильтрация сигнала с одним пропуском</p>
</div>
<p>Вопрос: А что, если бы использовался рекурсивный фильтр?</p>
<h2 id="странная-динамика">Странная динамика</h2>
<p>Температура на улице.</p>
<pre><code>bs = [5, 15, 35, -20, -10, 18, 28, 7, 7, 13, -25]
ts = np.arange(0, 60, 1)
xs = []
for i in range(len(ts)):
    xs.append(bs[i % len(bs)])</code></pre>
<div class="figure">
<img src="./ex_strange_dynamics.png" alt="Странная динамика" />
<p class="caption">Странная динамика</p>
</div>
<h2 id="слишком-много-отличий">Слишком много отличий</h2>
<p>Два датчика рядом, ожидаются похожие показания. Кто прав?</p>
<pre><code>ts = np.arange(0, 60, 0.02)
xs1 = np.cos(2*np.pi*1*ts)
xs2 = np.cos(2*np.pi*1*ts + 0.1)
bs = np.arange(-0.3, 0.3, 0.01)
for i in range(len(xs2)):
    xs2[i] = xs2[i] + bs[i % len(bs)]</code></pre>
<div class="figure">
<img src="./ex_differ.png" alt="Отличия" />
<p class="caption">Отличия</p>
</div>
<h2 id="другое">Другое</h2>
<ul>
<li><strong>TODO</strong> постоянное значение (всегда одно и то же) в &quot;адекватном&quot; диапазоне.</li>
<li><strong>TODO</strong> неадекватные значения.</li>
<li><strong>TODO</strong> недостаточное описание (единицы измерения угла)</li>
<li><strong>TODO</strong> неучтенные особенности данных (угол в кольце)</li>
</ul>
<h2 id="задания">Задания</h2>
<ul>
<li>Ознакомится с материалами о показателях вариации. Подумать, как можно использовать эти и другие показатели для выявления аномалий в исходных данных.</li>
<li>Найти другие примеры аномалий в исходных данных, предложить подход к их распознаванию.</li>
</ul>
<h2 id="ссылки">Ссылки</h2>
<ul>
<li>TODO: фильтрация</li>
<li><a href="http://edu.tltsu.ru/sites/sites_content/site216/html/media96435/lec_5.pdf">Показатели вариации</a></li>
<li><a href="https://ru.wikipedia.org/wiki/%D0%92%D0%B0%D1%80%D0%B8%D0%B0%D1%86%D0%B8%D1%8F_(%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D0%BA%D0%B0)">Вариация (статистика)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Coefficient_of_variation">Coefficient of variation</a></li>
</ul>
